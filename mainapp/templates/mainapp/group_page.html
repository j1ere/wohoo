{% extends 'home.html'%}
{% block title %} DM with {{ receiver.username }} {% endblock %}
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .group-chat {
            max-width: 800px;
            margin: 20px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 24px;
            margin: 0;
        }

        .create-group {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .chat-container {
            display: flex;
        }

        .member-list {
            width: 30%;
            border-right: 1px solid #ccc;
            padding-right: 20px;
        }

        .member-list h3 {
            margin: 0 0 10px;
        }

        .member-list ul {
            list-style-type: none;
            padding: 0;
        }

        .member-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .chat-window {
            width: 70%;
            padding-left: 20px;
        }

        .chat-window h3 {
            margin: 0 0 10px;
        }

        .messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            background-color: #fafafa;
        }

        input[type="text"] {
            width: 80%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }


        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
            position: relative;
        }

        .popup.hidden {
            display: none;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
            /***/
        .action-icon {
            cursor: pointer;
            margin-left: 10px;
        }

        .action-dropdown {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .action-dropdown button {
            display: block;
            width: 100%;
            border: none;
            background: none;
            padding: 10px;
            text-align: left;
            cursor: pointer;
        }

        .action-dropdown button:hover {
            background-color: #f0f0f0;
        }

        .hidden {
            display: none;
        }


    </style>

    <div class="group-chat">
        <header>
            <h1>Group Chat: [Group Name]</h1>
            <button class="create-group" onclick="showCreateGroupPopup()">Create Group</button>
        </header>
        
        <div class="chat-container">
            <div class="member-list">
                <h3>Members</h3>
                <ul id="member-list">
                    <li>
                        Username
                        <span class="action-icon" onclick="toggleActions(event)">&#9660;</span>
                        <div class="action-dropdown hidden">
                            <button onclick="makeAdmin('1')">Make Admin</button>
                            <button onclick="removeMember('1')">Remove</button>
                            <button onclick="dmUser('Username')">DM</button>
                        </div>
                    </li>
                    <!-- Repeat similar blocks for other members -->
                </ul>
            </div>
            <div class="chat-window">
                <h3>Chat</h3>
                <div id="messages" class="messages"></div>
                <input type="text" id="chat-input" placeholder="Type a message...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <!-- Popup for creating a group -->
        <div id="create-group-popup" class="popup hidden">
            <div class="popup-content">
                <span class="close" onclick="closeCreateGroupPopup()">&times;</span>
                <h2>Create Group</h2>
                <input type="text" id="group-name" placeholder="Group Name">
                <button onclick="createGroup()">Create</button>
            </div>
        </div>
    </div>

    <script>
        function showCreateGroupPopup() {
            document.getElementById('create-group-popup').classList.remove('hidden');
        }

        function closeCreateGroupPopup() {
            document.getElementById('create-group-popup').classList.add('hidden');
        }

        function createGroup() {
            const groupName = document.getElementById('group-name').value;
            // Logic to create a group goes here, like sending an AJAX request
            alert(`Group "${groupName}" created!`); // Example alert
            closeCreateGroupPopup();
        }

        function sendMessage() {
            const message = document.getElementById('chat-input').value;
            // Implement logic to send message via WebSocket or AJAX
            document.getElementById('chat-input').value = ''; // Clear input field
            document.getElementById('messages').innerHTML += `<div>${message}</div>`;
        }

        function makeAdmin(memberId) {
            // Logic to make the member an admin
            alert(`Made member ${memberId} an admin!`); // Example alert
        }

        function removeMember(memberId) {
            // Logic to remove the member from the group
            alert(`Removed member ${memberId} from the group!`); // Example alert
        }

        function dmUser(username) {
            // Redirect to DM with the user
            window.location.href = `/chat/home/${username}/`; // Example URL redirection
        }

        function toggleActions(event) {
            // Prevent the click event from bubbling up to the document
            event.stopPropagation();

            // Hide all other dropdowns first
            const allDropdowns = document.querySelectorAll('.action-dropdown');
            allDropdowns.forEach(dropdown => {
                if (!dropdown.classList.contains('hidden')) {
                    dropdown.classList.add('hidden');
                }
            });

            // Toggle the clicked dropdown
            const dropdown = event.target.nextElementSibling;
            if (dropdown) {
                dropdown.classList.toggle('hidden');
            }
        }

        // Hide dropdowns when clicking outside
        document.addEventListener('click', () => {
            const allDropdowns = document.querySelectorAll('.action-dropdown');
            allDropdowns.forEach(dropdown => dropdown.classList.add('hidden'));
        });


    </script> <!-- Link to your JavaScript file -->
{% endblock %}